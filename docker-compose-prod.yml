services:
  worker:
    build:
      context: .
      dockerfile: Dockerfile.worker
    env_file:
      - .env.local
    ports:
      - '8080:8080'
    restart: on-failure
    healthcheck:
      test: ['CMD-SHELL', 'wget -qO- http://localhost:8080/health || exit 1']
      interval: 30s
      timeout: 10s
      retries: 5
    logging:
      driver: 'json-file'
      options:
        max-size: '10m'
        max-file: '3'

  scheduler:
    build:
      context: .
      dockerfile: Dockerfile.worker
    command: ['node', '--import', 'tsx', 'scripts/start-schedular.ts']
    env_file:
      - .env.local
    restart: on-failure
    logging:
      driver: 'json-file'
      options:
        max-size: '10m'
        max-file: '3'

networks:
  default:
    driver: bridge
